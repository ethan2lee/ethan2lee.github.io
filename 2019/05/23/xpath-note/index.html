<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="李逸炫的博客">
    <meta name="keyword"  content="盈盛">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        xpath_note - Ethan Lee | ethan | ethan2lee
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 代码承旧万世基积沙镇海，梦想永在凌云意气风发 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>Ethan Lee</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Xpath-学习笔记"><span class="toc-text">Xpath 学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XPath概览"><span class="toc-text">XPath概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XPath常用规则"><span class="toc-text">XPath常用规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例讲解"><span class="toc-text">示例讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#选取所有节点"><span class="toc-text">选取所有节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选取某特定节点"><span class="toc-text">选取某特定节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选取节点下的子节点"><span class="toc-text">选取节点下的子节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#父节点"><span class="toc-text">父节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性匹配"><span class="toc-text">属性匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文本获取"><span class="toc-text">文本获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性获取"><span class="toc-text">属性获取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#属性多值匹配"><span class="toc-text">属性多值匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多属性匹配"><span class="toc-text">多属性匹配</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#按序选择"><span class="toc-text">按序选择</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> 代码承旧万世基积沙镇海，梦想永在凌云意气风发 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        xpath_note
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-05-23 09:33:19</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#xpath" title="xpath">xpath</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h1 id="Xpath-学习笔记"><a href="#Xpath-学习笔记" class="headerlink" title="Xpath 学习笔记"></a>Xpath 学习笔记</h1><h2 id="XPath概览"><a href="#XPath概览" class="headerlink" title="XPath概览"></a>XPath概览</h2><p>XPath，全称XML Path Language，即XML路径语言，它是一门在XML文档中查找信息的语言。它最初是用来搜寻XML文档的，但是它同样适用于HTML文档的搜索。</p>
<p>所以在做爬虫时，我们完全可以使用XPath来做相应的信息抽取。本节中，我们就来介绍XPath的基本用法。 </p>
<p>XPath的选择功能十分强大，它提供了非常简洁明了的路径选择表达式。另外，它还提供了超过100个内建函数，用于字符串、数值、时间的匹配以及节点、序列的处理等。几乎所有我们想要定位的节点，都可以用XPath来选择。</p>
<p>它被设计为供XSLT、XPointer以及其他XML解析软件使用，更多的文档可以访问其官方网站：<a href="https://www.w3.org/TR/xpath/。" target="_blank" rel="noopener">https://www.w3.org/TR/xpath/。</a></p>
<h2 id="XPath常用规则"><a href="#XPath常用规则" class="headerlink" title="XPath常用规则"></a>XPath常用规则</h2><table>
<thead>
<tr>
<th style="text-align:center">表达式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">nodename</td>
<td style="text-align:center">选取此节点的所有子节点</td>
</tr>
<tr>
<td style="text-align:center">/</td>
<td style="text-align:center">从当前节点选取直接子节点</td>
</tr>
<tr>
<td style="text-align:center">//</td>
<td style="text-align:center">从当前节点选取子孙节点</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:center">选取当前节点</td>
</tr>
<tr>
<td style="text-align:center">..</td>
<td style="text-align:center">选取当前节点的父节点</td>
</tr>
<tr>
<td style="text-align:center">@</td>
<td style="text-align:center">选取属性</td>
</tr>
</tbody>
</table>
<p>XPath的常用匹配规则，示例如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_xpath=<span class="string">"//title[@class='python']"</span></span><br><span class="line">html.xpath()</span><br></pre></td></tr></table></figure></p>
<p>这就是一个XPath规则，它代表选择所有名称为title，同时属性class的值为python的节点。<br>后面会通过Python的lxml库，利用XPath进行HTML的解析。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span>  lxml</span><br></pre></td></tr></table></figure>
<p>使用以上命令，安装即可。</p>
<h2 id="示例讲解"><a href="#示例讲解" class="headerlink" title="示例讲解"></a>示例讲解</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br></pre></td></tr></table></figure>
<p>对基本包导入，我们需要用到etree这个包来解析网页。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;</span></span><br><span class="line"><span class="string">     &lt;/ul&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>我们自己声明一个变量，该变量是字符创，html格式的文本，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html = etree.HTML(text)</span><br></pre></td></tr></table></figure>
<p>调用HTML类进行初始化，这样就成功构造了一个XPath解析对象。这里需要注意的是，HTML文本中的最后一个li节点是没有闭合的，但是etree模块可以自动修正HTML文本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(etree.tostring(html).decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">         &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class="item-1"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;</span><br><span class="line">     &lt;/li&gt;&lt;/ul&gt;</span><br><span class="line"><span class="xml"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>调用tostring()方法即可输出修正后的HTML代码，但是结果是bytes类型。这里利用decode()方法将其转成str类型。<br>我们可以看到，经过处理之后，li节点标签被补全，并且还自动添加了body、html节点。</p>
<h3 id="选取所有节点"><a href="#选取所有节点" class="headerlink" title="选取所有节点"></a>选取所有节点</h3><p>一般会用//开头的XPath规则来选取所有符合要求的节点。这里以前面的HTML文本为例，如果要选取所有节点，可以这样实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//*'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[&lt;Element <span class="selector-tag">html</span> at <span class="number">0</span>x199551eb408&gt;,</span><br><span class="line">&lt;Element <span class="selector-tag">body</span> at <span class="number">0</span>x19955205108&gt;,</span><br><span class="line">&lt;Element <span class="selector-tag">div</span> at <span class="number">0</span>x19955243288&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">ul</span> at <span class="number">0</span>x19955243508&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">li</span> at <span class="number">0</span>x19955243388&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">a</span> at <span class="number">0</span>x199552433c8&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">li</span> at <span class="number">0</span>x19955243408&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">a</span> at <span class="number">0</span>x199552434c8&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">li</span> at <span class="number">0</span>x19955243608&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">a</span> at <span class="number">0</span>x19955243488&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">li</span> at <span class="number">0</span>x19955243648&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">a</span> at <span class="number">0</span>x19955243688&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">li</span> at <span class="number">0</span>x199552436c8&gt;,</span><br><span class="line">     &lt;Element <span class="selector-tag">a</span> at <span class="number">0</span>x19955243708&gt;]</span><br></pre></td></tr></table></figure>
<p>这里使用*代表匹配所有节点，也就是整个HTML文本中的所有节点都会被获取。<br>可以看到，返回形式是一个列表，每个元素是Element类型，其后跟了节点的名称，如html、body、div、ul、li、a等，所有节点都包含在列表中了。</p>
<h3 id="选取某特定节点"><a href="#选取某特定节点" class="headerlink" title="选取某特定节点"></a>选取某特定节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">[&lt;Element li at 0x19955243388&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element li at 0x19955243408&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element li at 0x19955243608&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element li at 0x19955243648&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element li at 0x199552436c8&gt;]</span></span><br></pre></td></tr></table></figure>
<p>如上所示，此处匹配也可以指定节点名称。获取所有li节点，可以用//，然后加上节点名称既可以，调用时依然需要使用xpath()方法。<br>返回的结果是个列表，里面的元素是可以操作的<code>Element</code>对象。</p>
<h3 id="选取节点下的子节点"><a href="#选取节点下的子节点" class="headerlink" title="选取节点下的子节点"></a>选取节点下的子节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li/a'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&lt;Element a at 0x199552433c8&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x199552434c8&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x19955243488&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x19955243688&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x19955243708&gt;]</span></span><br></pre></td></tr></table></figure>
<p>我们通过<code>/</code>或<code>//</code>即可查找元素的子节点或子孙节点。如上我们选择li节点的所有直接a子节点。<br>以上的<code>/</code>用于选取直接的子节点，如果想要获取所有的子孙节点，可以使用<code>//</code>.<br>例如，我们获取’ul’节点下的所有子孙节点<code>a</code>,代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//ul//a'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&lt;Element a at 0x199552433c8&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x199552434c8&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x19955243488&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x19955243688&gt;,</span></span><br><span class="line"><span class="meta"> &lt;Element a at 0x19955243708&gt;]</span></span><br></pre></td></tr></table></figure>
<h3 id="父节点"><a href="#父节点" class="headerlink" title="父节点"></a>父节点</h3><p>我们知道通过连续的/或//可以查找子节点或子孙节点，那么假如我们知道了子节点，怎样来查找父节点呢？这可以用..来实现。</p>
<p>比如，现在首先选中href属性为link4.html的a节点，然后再获取其父节点，然后再获取其class属性，相关代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//a[@href="link4.html"]/../@class'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'item-1</span>']</span><br></pre></td></tr></table></figure>
<p>检查一下结果发现，这正是我们获取的目标li节点的class。<br>同时，我们也可以通过parent::来获取父节点，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//a[@href="link4.html"]/parent::*/@class'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'item-1</span>']</span><br></pre></td></tr></table></figure>
<h3 id="属性匹配"><a href="#属性匹配" class="headerlink" title="属性匹配"></a>属性匹配</h3><p>在选取的时候，我们还可以用@符号进行属性过滤。<br>比如，这里如果要选取class为item-1的li节点，可以这样实现:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[@class="item-0"]'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[&lt;Element li at 0x19955243388&gt;, &lt;Element li at 0x199552436c8&gt;]</span></span><br></pre></td></tr></table></figure>
<p>这里我们通过加入[@class=”item-0”]，限制了节点的class属性为item-0，而HTML文本中符合条件的li节点有两个，所以结果应该返回两个匹配到的元素。</p>
<h3 id="文本获取"><a href="#文本获取" class="headerlink" title="文本获取"></a>文本获取</h3><p>我们用XPath中的text()方法获取节点中的文本，接下来尝试获取前面li节点中的文本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[@class="item-0"]/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">['\n     ']</span><br></pre></td></tr></table></figure>
<p>奇怪的是，我们并没有获取到任何文本，只获取到了一个换行符，这是为什么呢？因为XPath中<code>text()</code>前面是<code>/</code>，<br>而此处/的含义是选取直接子节点，很明显li的直接子节点都是a节点，文本都是在a节点内部的，<br>所以这里匹配到的结果就是被修正的li节点内部的换行符，因为自动修正的li节点的尾标签换行了。<br>即选中的是这两个节点：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"item-0"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">&lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"item-0"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/li&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中一个节点因为自动修正，li节点的尾标签添加的时候换行了，所以提取文本得到的唯一结果就是li节点的尾标签和a节点的尾标签之间的换行符。</p>
<p>因此，如果想获取<code>li</code>节点内部的文本，就有两种方式，一种是先选取a节点再获取文本，另一种就是使用<code>//</code>。接下来，我们来看下二者的区别。</p>
<p>首先，选取到a节点再获取文本，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[@class="item-0"]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'first</span> item', <span class="symbol">'fifth</span> item']</span><br></pre></td></tr></table></figure>
<p>可以看到，这里的返回值是两个，内容都是属性为item-0的li节点的文本，这也印证了前面属性匹配的结果是正确的。</p>
<p>这里我们是逐层选取的，先选取了li节点，又利用/选取了其直接子节点a，然后再选取其文本，得到的结果恰好是符合我们预期的两个结果。<br>再来看下用另一种方式（即使用//）选取的结果，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[@class="item-0"]//text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="symbol">'first</span> item', <span class="symbol">'fifth</span> item', '\n     ']</span><br></pre></td></tr></table></figure>
<p>不出所料，这里的返回结果是3个。可想而知，这里是选取所有子孙节点的文本，其中前两个就是li的子节点a节点内部的文本，另外一个就是最后一个li节点内部的文本，即换行符。</p>
<p>所以说，如果要想获取子孙节点内部的所有文本，可以直接用//加text()的方式，这样可以保证获取到最全面的文本信息，但是可能会夹杂一些换行符等特殊字符。如果想获取某些特定子孙节点下的所有文本，可以先选取到特定的子孙节点，然后再调用text()方法获取其内部文本，这样可以保证获取的结果是整洁的。</p>
<h3 id="属性获取"><a href="#属性获取" class="headerlink" title="属性获取"></a>属性获取</h3><p>我们知道用text()可以获取节点内部文本，那么节点属性该怎样获取呢？其实还是用@符号就可以。例如，我们想获取所有li节点下所有a节点的href属性，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li/a/@href'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'link1.html</span>', <span class="symbol">'link2.html</span>', <span class="symbol">'link3.html</span>', <span class="symbol">'link4.html</span>', <span class="symbol">'link5.html</span>']</span><br></pre></td></tr></table></figure>
<p>我们通过@href即可获取节点的href属性。注意，此处和属性匹配的方法不同，属性匹配是中括号加属性名和值来限定某个属性，如[@href=”link1.html”]，而此处的@href指的是获取节点的某个属性，二者需要做好区分。</p>
<h4 id="属性多值匹配"><a href="#属性多值匹配" class="headerlink" title="属性多值匹配"></a>属性多值匹配</h4><p>有时候，某些节点的某个属性可能有多个值，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br></pre></td></tr></table></figure>
<p>这里HTML文本中li节点的class属性有两个值li和li-first，此时如果还想用之前的属性匹配获取，就无法匹配了，此时的运行结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[@class="li"]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>这时就需要用contains()函数了，代码可以改写如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[contains(@class, "li")]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'first</span> item']</span><br></pre></td></tr></table></figure>
<p>此种方式在某个节点的某个属性有多个值时经常用到，如某个节点的class属性通常有多个。</p>
<h4 id="多属性匹配"><a href="#多属性匹配" class="headerlink" title="多属性匹配"></a>多属性匹配</h4><p>，我们可能还遇到一种情况，那就是根据多个属性确定一个节点，这时就需要同时匹配多个属性。此时可以使用运算符and来连接，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first" name="item"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br></pre></td></tr></table></figure>
<p>这里的li节点又增加了一个属性name。要确定这个节点，需要同时根据class和name属性来选择，一个条件是class属性里面包含li字符串，另一个条件是name属性为item字符串，二者需要同时满足，需要用and操作符相连，相连之后置于中括号内进行条件筛选。运行结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[contains(@class, "li") and @name="item"]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'first</span> item']</span><br></pre></td></tr></table></figure>
<p>运算符及其介绍</p>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">实例</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">or</td>
<td style="text-align:center">或</td>
<td style="text-align:center">age=19 or age=20</td>
<td>如果age是19，则返回true。如果age是21，则返回false</td>
</tr>
<tr>
<td style="text-align:center">and</td>
<td style="text-align:center">与</td>
<td style="text-align:center">age&gt;19 and age&lt;21</td>
<td>如果age是20，则返回true。如果age是18，则返回false</td>
</tr>
<tr>
<td style="text-align:center">mod</td>
<td style="text-align:center">计算除法的余数</td>
<td style="text-align:center">5 mod 2</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:center">加法</td>
<td style="text-align:center">6 + 4</td>
<td>10</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center">减法</td>
<td style="text-align:center">6 - 4</td>
<td>2</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">乘法</td>
<td style="text-align:center">6 * 4</td>
<td>24</td>
</tr>
<tr>
<td style="text-align:center">div</td>
<td style="text-align:center">除法</td>
<td style="text-align:center">8 div 4</td>
<td>2</td>
</tr>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center">等于</td>
<td style="text-align:center">age=19</td>
<td>如果age是19，则返回true。如果age是20，则返回false</td>
</tr>
<tr>
<td style="text-align:center">!=</td>
<td style="text-align:center">不等于</td>
<td style="text-align:center">age!=19</td>
<td>如果age是18，则返回true。如果age是19，则返回false</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于</td>
<td style="text-align:center">age&lt;19</td>
<td>如果age是18，则返回true。如果age是19，则返回false</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于或等于</td>
<td style="text-align:center">age&lt;=19</td>
<td>如果age是19，则返回true。如果age是20，则返回false</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
<td style="text-align:center">age&gt;19</td>
<td>如果age是20，则返回true。如果age是19，则返回false</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于或等于</td>
<td style="text-align:center">age&gt;=19</td>
<td>如果age是19，则返回true。如果age是18，则返回false</td>
</tr>
</tbody>
</table>
<h3 id="按序选择"><a href="#按序选择" class="headerlink" title="按序选择"></a>按序选择</h3><p>有时候，我们在选择的时候某些属性可能同时匹配了多个节点，但是只想要其中的某个节点，如第二个节点或者最后一个节点，这时该怎么办呢？<br>这时可以利用中括号传入索引的方法获取特定次序的节点，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;</span></span><br><span class="line"><span class="string">     &lt;/ul&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br></pre></td></tr></table></figure>
<p>我们选取了第一个li节点，中括号中传入数字1即可。注意，这里和代码中不同，序号是以1开头的，不是以0开头。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[1]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'first</span> item']</span><br></pre></td></tr></table></figure>
<p>我们选取了最后一个li节点，中括号中传入last()即可，返回的便是最后一个li节点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[last()]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'fifth</span> item']</span><br></pre></td></tr></table></figure>
<p>我们选取了位置小于3的li节点，也就是位置序号为1和2的节点，得到的结果就是前两个li节点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[position()&lt;3]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'first</span> item', <span class="symbol">'second</span> item']</span><br></pre></td></tr></table></figure>
<p>我们选取了倒数第三个li节点，中括号中传入last()-2即可。因为last()是最后一个，所以last()-2就是倒数第三个。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.xpath(<span class="string">'//li[last()-2]/a/text()'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'third</span> item']</span><br></pre></td></tr></table></figure>
<p>如果想查询更多XPath的用法，可以查看：<a href="http://www.w3school.com.cn/xpath/index.asp。" target="_blank" rel="noopener">http://www.w3school.com.cn/xpath/index.asp。</a></p>
<p>如果想查询更多Python lxml库的用法，可以查看<a href="http://lxml.de/。" target="_blank" rel="noopener">http://lxml.de/。</a></p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">赞赏</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="/img/donate.jpg">
        <p> 你的支持是我写作的莫大鼓励 </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
	



    <ul class="list-inline text-center">


	




        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/ethan2lee">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="http://anne2bin.top">anne2bin</a></span>
        <span>/</span>
        
        <span><a href="https://blog.ywandy.top/">yewei_andy</a></span>
        <span>/</span>
        
        <span><a href="https://wwb.colonp.top/">wwb</a></span>
        <span>/</span>
        
    </p>
    
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


    <script>
        /**
         *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
        */
        if( '' || '')
        var disqus_config = function () {
            this.page.url = '';  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://ethan2lee.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>

</html>
